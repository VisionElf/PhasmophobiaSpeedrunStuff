<!DOCTYPE html>
<html>
<head>
	<title>Phasmophobia Any% - Leaderboard</title>
	<!-- CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<style type="text/css">
		.table {
			width: 1300px;
		}

		img {
			height: 12px;
			vertical-align: middle;
		    margin-top: -4px;
		    border-radius: 2px;
		    filter: drop-shadow(1px 1px rgba(0,0,0,0.1));
		}

		th,td {
			text-align:center !important;
			vertical-align: middle !important;
		}

		.time {
			text-align: center;
			vertical-align: middle;
			font-size: 0.9rem;
		}
		.players {
			text-align: center;
			vertical-align: middle;
			font-size: 0.9rem;
			font-weight: bold;
			text-shadow: 1px 1px rgba(0,0,0,0.5);
		}
	</style>
</head>
<body>

<table class="table table-sm table-dark">
	<thead>
		<tr>
			<th></th>
			<th>Solo</th>
			<th>Duo</th>
			<th>Trio</th>
			<th>Quartet</th>
		</tr>
	</thead>
	<tbody>
		<tr class="any">
			<th>Full Game</th>
			<td class="rklr77nk">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="ndx4oor2">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="w203rr52">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="wdm6nnok">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
		</tr>
		<tr class="rdnq4m7d">
			<th>Tanglewood Street</th>
			<td class="q25m69yd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdrl46gd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdzwz03d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="zd3xe48d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
		</tr>
		<tr class="gdry60lw">
			<th>Edgefield Street House</th>
			<td class="q25m69yd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdrl46gd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdzwz03d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="zd3xe48d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
		</tr>
		<tr class="rw6m57g9">
			<th>Ridgeview Road House</th>
			<td class="q25m69yd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdrl46gd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdzwz03d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="zd3xe48d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
		</tr>
		<tr class="z98m4opw">
			<th>Grafton Farmhouse</th>
			<td class="q25m69yd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdrl46gd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdzwz03d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="zd3xe48d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
		</tr>
		<tr class="ldy3lrr9">
			<th>Bleasdale Farmhouse</th>
			<td class="q25m69yd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdrl46gd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdzwz03d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="zd3xe48d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
		</tr>
		<tr class="n93mzxzd">
			<th>Brownstone High School</th>
			<td class="q25m69yd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdrl46gd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdzwz03d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="zd3xe48d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
		</tr>
		<tr class="xd046e4w">
			<th>Asylum</th>
			<td class="q25m69yd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdrl46gd">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="jdzwz03d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
			<td class="zd3xe48d">
				<div class="time">0:00</div>
				<div class="players"></div>
			</td>
		</tr>
	</tbody>
</table>

</body>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
var speedrunApi = "https://www.speedrun.com/api/v1/";
var phasmoId = "m1zjpl36";
var flagUrl = "https://www.speedrun.com/images/flags/";

function api(url, data, success)
{
	apiUri(speedrunApi + url, data, success);
}

function apiUri(uri, data, success)
{
	$.ajax({
		url: uri,
		data: data, 
		dataType: "json",
		success: success,
		error: function(error)
		{
			console.log(error);
		}
	});
}

levels = [
{id:"rdnq4m7d", name:"Tanglewood Street"},
{id:"gdry60lw", name:"Edgefield Street House"},
{id:"rw6m57g9", name:"Ridgeview Road House"},
{id:"z98m4opw", name:"Grafton Farmhouse"},
{id:"ldy3lrr9", name:"Bleasdale Farmhouse"},
{id:"n93mzxzd", name:"Brownstone High School"},
{id:"xd046e4w", name:"Asylum"}
];

level_variables = {
'rdnq4m7d':'?var-e8mrvwwl=21gddjn1',
'gdry60lw':'?var-ylqmgewn=klr44zjq',
'rw6m57g9':'?var-gnxvdyxl=21gddjx1',
'z98m4opw':'?var-6nj4dw5n=810jj9pl',
'ldy3lrr9':'?var-68k4r9zl=klr44nwq',
'n93mzxzd':'?var-j84ex4yn=5q88856q',
'xd046e4w':'?var-p85471vl=810jj3pl',
};

categories = [
{id:"q25m69yd", name: "Solo"},
{id:"jdrl46gd", name: "Duo"},
{id:"jdzwz03d", name: "Trio"},
{id:"zd3xe48d", name: "Quartet"}
];

full_categories = [
{id: "rklr77nk", name: "Solo"},
{id: "ndx4oor2", name: "Duo"},
{id: "w203rr52", name: "Trio"},
{id: "wdm6nnok", name: "Quartet"}
];

full_variables = {
'any':'?var-onvj1o5n=814gggk1',
'full':'?var-onvj1o5n=z19yyy4l',
};

function formatTime(time)
{
	var milliseconds = (""+time).split('.')[1];
	var seconds = (""+time).split('.')[0];

	var minutes = Math.floor(seconds / 60);
	seconds -= minutes * 60;
	seconds = Math.round(seconds)

	if (milliseconds == undefined) milliseconds = "00";
	else if (milliseconds < 100) milliseconds *= 10;

	if (milliseconds < 100) milliseconds = "0" + milliseconds;
	else if (milliseconds < 10) milliseconds = "00" + milliseconds;

	var result = "";
	result += minutes + "m ";
	if (seconds < 10) result += "0";
	result += seconds + "s ";
	result += milliseconds + "ms";
	return result;
}

for (var i in levels)
{
	var level = levels[i];
	for (var j in categories)
	{
		var category = categories[j];
		addRun(level, category);
	}
}

for (var i in full_categories)
{
	var cat = full_categories[i];
	addFull(cat, "any");
	//addFull(cat, "full");
}

function addFull(category, type)
{
	api("leaderboards/" + phasmoId + "/category/" + category.id + full_variables[type], {top:1},
		function(data)
		{
			var runs = data.data.runs;
			for (var j in runs)
			{
				var run = runs[j];
				addFullRun(run.run, category, type);
			}
		}
	);
}

function addFullRun(run, category, type)
{
	if (run == undefined) return;

	var eltStr=  "." + type + " ." + run.category + " .time";
	$(eltStr).html(formatTime(run.times.primary_t));

	var players = run.players;
	for (var b in players)
	{
		var player = players[b];
		addPlayer(type, category.id, player);
	}
}

function addRun(level, category)
{
	api("leaderboards/" + phasmoId + "/level/" + level.id + "/" + category.id + level_variables[level.id], {top:1},
		function success(data)
		{
			var runs = data.data.runs;
			for (var a in runs)
			{
				var run = runs[a].run;
				var eltStr=  "." + run.level + " ." + run.category + " .time";
				$(eltStr).html(formatTime(run.times.primary_t));

				var players = run.players;
				for (var b in players)
				{
					var player = players[b];
					addPlayer(level.id, category.id, player);
				}
			}
		});
}

function addPlayer(levelId, categoryId, player)
{
	apiUri(player.uri, {},
		function success(data)
		{
			var elt = data.data;
			var name = elt.names.international;
			var flag = "";
			if (elt.location != null)
				flag = "<img src='" + flagUrl + elt.location.country.code + ".png" + "'></img> ";
			var color = elt['name-style']['color-from'].dark;

			var result = "<div style='color: " + color + "'>" + flag + name + "</div>";
			var eltStr=  "." + levelId + " ." + categoryId + " .players";
			$(eltStr).append(result);
		}
	);
}


var myId = "v81k2epj";

//getRejectedRuns(myId);

function getRejectedRuns(examinerId)
{
	api("runs",
		{
			status: "rejected",
			examiner: examinerId
		},
		function (data)
		{
			var runs = data.data;
			for (var i in runs)
			{
				var run = runs[i];
				var reason = run.status.reason;
				console.log(run.weblink)
				console.log(reason);
			}
		}
	);
}

</script>